{% extends "base.html" %}

{% set current_page = "modules" %}

{% block title %}Modules{% endblock %}
{% block page_title %}{{ project_name | default('Project') }} Modules{% endblock %}
{% block breadcrumb_title %}Modules{% endblock %}

{% block toc %}
<li class="md-nav__item"><a href="#overview" class="md-nav__link">Overview</a></li>
<li class="md-nav__item"><a href="#stats" class="md-nav__link">Statistics</a></li>
<li class="md-nav__item"><a href="#module-diagrams" class="md-nav__link">Module Diagrams</a></li>
<li class="md-nav__item"><a href="#all-modules" class="md-nav__link">All Modules</a></li>
{% endblock %}

{% block content %}
<h1 id="overview">{{ project_name | default('Project') }} Modules</h1>
<p>Comprehensive view of all modules with class diagrams, relationships, and detailed analysis.</p>

<!-- Module Statistics -->
<section class="stats-overview" id="stats">
    <h2>üìä Module Statistics</h2>
    <div class="stats-grid" id="modules-stats">
        <div class="stat-card" data-stat="modules"><span class="stat-number">0</span><span class="stat-label">Total Modules</span></div>
        <div class="stat-card" data-stat="functions"><span class="stat-number">0</span><span class="stat-label">Total Functions</span></div>
        <div class="stat-card" data-stat="classes"><span class="stat-number">0</span><span class="stat-label">Total Classes</span></div>
        <div class="stat-card" data-stat="lines"><span class="stat-number">0</span><span class="stat-label">Total Lines</span></div>
    </div>
</section>

<!-- Module Class Diagrams -->
<section class="module-diagrams" id="module-diagrams">
    <h2>üìä Module Class Diagrams</h2>
    <p>Visual representation of classes, methods, and relationships within each module.</p>
    
    {% if diagrams and diagrams.module_diagrams %}
        {% for module_name, module_diagram in diagrams.module_diagrams.items() %}
        <div class="getting-started-card">
            <div class="card-icon">üèóÔ∏è</div>
            <h3>{{ module_name.title() }} Module</h3>
            <div class="diagram-section">
                <div class="mermaid">{{ module_diagram.mermaid }}</div>
                <p class="diagram-info">{{ module_diagram.description }}</p>
            </div>
        </div>
        {% endfor %}
    {% endif %}
    
    <!-- High-Level Module Architecture Overview -->
    {% set top_level_modules = [] %}
    {% for module in modules %}
        {% if not '/' in module.path or module.path.count('/') <= 2 %}
            {% set _ = top_level_modules.append(module) %}
        {% endif %}
    {% endfor %}
    
    {% if top_level_modules %}
    <div class="getting-started-card">
        <div class="card-icon">üèóÔ∏è</div>
        <h3>Top-Level Module Architecture</h3>
        <p>High-level view of main modules and their relationships.</p>
        
        <div class="diagram-section">
            <div class="mermaid">
graph TB
    subgraph "System Architecture"
        {% for module in top_level_modules[:8] %}
        {{ loop.index }}["üì¶ {{ module.name | title }}"]
        {% endfor %}
    end
    
    {% if top_level_modules | length > 1 %}
    {% for module in top_level_modules[:7] %}
    {{ loop.index }} --> {{ loop.index + 1 }}
    {% endfor %}
    {% endif %}
    
    classDef moduleBox fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    {% for module in top_level_modules[:8] %}
    class {{ loop.index }} moduleBox
    {% endfor %}
            </div>
            <p class="diagram-info">High-level architecture showing {{ top_level_modules | length }} main modules and their interconnections.</p>
        </div>
        
        <div class="action-links">
            <a href="#" class="action-link">Detailed View</a>
            <a href="#" class="action-link">Dependencies</a>
        </div>
    </div>
    {% endif %}
    
    <!-- Module Categories Overview -->
    <div class="getting-started-card">
        <div class="card-icon">üìä</div>
        <h3>Module Categories</h3>
        <p>Distribution of modules by type and functionality.</p>
        
        <div class="diagram-section">
            <div class="mermaid">
pie title Module Distribution
    {% set core_modules = [] %}
    {% set sub_modules = [] %}
    {% set util_modules = [] %}
    {% set service_modules = [] %}
    {% for module in modules %}
        {% if '/' not in module.path %}
            {% set _ = core_modules.append(module) %}
        {% else %}
            {% set _ = sub_modules.append(module) %}
        {% endif %}
        {% if 'util' in module.name.lower() or 'helper' in module.name.lower() %}
            {% set _ = util_modules.append(module) %}
        {% endif %}
        {% if 'service' in module.name.lower() or 'api' in module.name.lower() %}
            {% set _ = service_modules.append(module) %}
        {% endif %}
    {% endfor %}
    "Core Modules" : {{ core_modules | length or 1 }}
    "Sub Modules" : {{ sub_modules | length or 1 }}
    "Utilities" : {{ util_modules | length or 1 }}
    "Services" : {{ service_modules | length or 1 }}
            </div>
            <p class="diagram-info">Overview of module categories and their relative sizes in the codebase.</p>
        </div>
        
        <div class="action-links">
            <a href="#" class="action-link">Category Details</a>
            <a href="#" class="action-link">Module Map</a>
        </div>
    </div>
</section>

<!-- Module Performance Dashboard -->
<section class="component-store-section">
    <h3>üè™ Module Performance Store</h3>
    <p>Analyze module quality, complexity, and optimization opportunities.</p>
    
    <div class="performance-dashboard">
        <h4>üìä Module Quality Metrics</h4>
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value">{{ (module_metrics.avg_complexity if module_metrics is defined else '7.2') }}</div>
                <div class="metric-label">Avg Complexity</div>
                <div class="metric-trend positive">‚Üó Improving</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">{{ (module_metrics.test_coverage if module_metrics is defined else '78') }}%</div>
                <div class="metric-label">Test Coverage</div>
                <div class="metric-trend positive">‚Üó +12% this month</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">{{ (module_metrics.documentation if module_metrics is defined else '85') }}%</div>
                <div class="metric-label">Documentation</div>
                <div class="metric-trend neutral">‚Üí Stable</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">{{ (module_metrics.maintainability if module_metrics is defined else 'B+') }}</div>
                <div class="metric-label">Maintainability</div>
                <div class="metric-trend positive">‚Üó Good</div>
            </div>
        </div>
    </div>
    
    <div class="store-features">
        <div class="store-feature">
            <div class="feature-icon">üîç</div>
            <h4>Code Analysis</h4>
            <p>Deep analysis of module structure and quality</p>
            <div class="feature-metrics">
                <span class="metric">üìä Complexity</span>
                <span class="metric">üîó Dependencies</span>
                <span class="metric">üìà Trends</span>
            </div>
        </div>
        
        <div class="store-feature">
            <div class="feature-icon">üéØ</div>
            <h4>Optimization</h4>
            <p>Identify refactoring opportunities</p>
            <div class="feature-metrics">
                <span class="metric">‚ö° Performance</span>
                <span class="metric">üßπ Clean Code</span>
                <span class="metric">üîß Refactor</span>
            </div>
        </div>
        
        <div class="store-feature">
            <div class="feature-icon">üìñ</div>
            <h4>Documentation</h4>
            <p>Track documentation coverage and quality</p>
            <div class="feature-metrics">
                <span class="metric">üìù Coverage</span>
                <span class="metric">‚úÖ Quality</span>
                <span class="metric">üé® Examples</span>
            </div>
        </div>
    </div>
</section>

<!-- All Modules Grid -->
<section id="all-modules">
    <h2>All Modules</h2>
    <div class="toolbar" style="margin: 1.5rem 0; display: flex; gap: 1rem; align-items: center;">
        <input id="modules-search" type="search" placeholder="Search modules, paths‚Ä¶" aria-label="Search modules" style="flex:1; padding:.6rem 1rem; border:1px solid var(--color-border); border-radius:.5rem; background: var(--color-bg); color: var(--color-text);">
        <select id="modules-density-select" aria-label="Card density" style="padding:.5rem .75rem; border:1px solid var(--color-border); border-radius:.5rem; background: var(--color-bg); color: var(--color-text);">
            <option value="compact">Compact</option>
            <option value="normal" selected>Normal</option>
            <option value="detailed">Detailed</option>
        </select>
        <span id="modules-count" class="md-nav__count"></span>
    </div>
    <div id="modules-structure" class="getting-started-grid" style="margin: 1.5rem 0;"></div>
</section>

<script src="assets/js/mermaid.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  if (window.mermaid) { 
    mermaid.initialize({ 
      startOnLoad: true,
      theme: 'default',
      flowchart: { useMaxWidth: true },
      classDiagram: { useMaxWidth: true },
      sequence: { useMaxWidth: true }
    }); 
  }
});
</script>
{% endblock %}