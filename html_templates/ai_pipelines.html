{% extends "base.html" %}

{% set current_page = "ai_pipelines" %}

{% block title %}AI Pipelines{% endblock %}
{% block page_title %}{{ project_name | default('Project') }} AI Pipelines{% endblock %}
{% block breadcrumb_title %}AI Pipelines{% endblock %}

{% block toc %}
<li class="md-nav__item"><a href="#overview" class="md-nav__link">Overview</a></li>
<li class="md-nav__item"><a href="#pipelines" class="md-nav__link">Pipelines</a></li>
<li class="md-nav__item"><a href="#components" class="md-nav__link">Components</a></li>
<li class="md-nav__item"><a href="#performance" class="md-nav__link">Performance</a></li>
{% endblock %}

{% block content %}
<h1 id="overview">{{ project_name | default('Project') }} AI Pipelines</h1>
<p>Data processing pipelines, AI workflows, and intelligent automation components.</p>

{% set pipelines = ai_analysis.pipelines if ai_analysis else [] %}
{% set processors = ai_analysis.data_processors if ai_analysis else [] %}
{% set sources = ai_analysis.data_sources if ai_analysis else [] %}
{% set extractors = ai_analysis.feature_extractors if ai_analysis else [] %}

<!-- Stats Overview -->
<section class="stats-overview">
    <h2>📊 Pipeline Statistics</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <span class="stat-number">{{ pipelines|length if pipelines else 0 }}</span>
            <span class="stat-label">Pipelines</span>
        </div>
        <div class="stat-card">
            <span class="stat-number">{{ processors|length if processors else 0 }}</span>
            <span class="stat-label">Processors</span>
        </div>
        <div class="stat-card">
            <span class="stat-number">{{ sources|length if sources else 0 }}</span>
            <span class="stat-label">Data Sources</span>
        </div>
        <div class="stat-card">
            <span class="stat-number">{{ extractors|length if extractors else 0 }}</span>
            <span class="stat-label">Extractors</span>
        </div>
    </div>
</section>

{% if pipelines %}
<section class="pipelines-section">
    <h2 id="pipelines">⚙️ Active Pipelines</h2>
    <p>Intelligent data processing and AI workflow pipelines.</p>
    
    <div class="getting-started-grid">
        {% for p in pipelines %}
        <div class="getting-started-card">
            <div class="card-icon">🔄</div>
            <h3>{{ p.name | default('Pipeline') }}</h3>
            
            <div class="pipeline-info">
                <p><strong>Stages:</strong> {{ p.stages | length if p.stages else 0 }} processing stages</p>
                
                {% if p.inputs %}
                <strong>Inputs:</strong>
                <div class="code-block">
                    <code>{{ p.inputs | join(', ') }}</code>
                </div>
                {% endif %}
                
                {% if p.outputs %}
                <strong>Outputs:</strong>
                <div class="code-block">
                    <code>{{ p.outputs | join(', ') }}</code>
                </div>
                {% endif %}
                
                {% if p.path %}
                <strong>Location:</strong>
                <div class="code-block">
                    <code>{{ p.path }}</code>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- Components Section -->
<section class="components-section" id="components">
    <h2>🏗️ Pipeline Components</h2>
    <p>Essential components that power the AI pipelines.</p>
    
    <div class="getting-started-grid">
        {% if processors %}
        <!-- Data Processors -->
        <div class="getting-started-card">
            <div class="card-icon">⚡</div>
            <h3>Data Processors</h3>
            <p>{{ processors|length }} processors for data transformation</p>
            
            {% for pr in processors[:3] %}
            <div class="processor-item">
                <strong>{{ pr.name | default('Processor') }}</strong>
                <span class="badge">{{ pr.type | default('Transform') }}</span>
            </div>
            {% endfor %}
            
            {% if processors|length > 3 %}
            <div class="action-links">
                <span class="action-link">+{{ processors|length - 3 }} more</span>
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        {% if sources %}
        <!-- Data Sources -->
        <div class="getting-started-card">
            <div class="card-icon">💾</div>
            <h3>Data Sources</h3>
            <p>{{ sources|length }} configured data sources</p>
            
            {% for s in sources[:3] %}
            <div class="source-item">
                <strong>{{ s.name | default('Source') }}</strong>
                <span class="badge">{{ s.type | default('Data') }}</span>
            </div>
            {% endfor %}
            
            {% if sources|length > 3 %}
            <div class="action-links">
                <span class="action-link">+{{ sources|length - 3 }} more</span>
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        {% if extractors %}
        <!-- Feature Extractors -->
        <div class="getting-started-card">
            <div class="card-icon">🔍</div>
            <h3>Feature Extractors</h3>
            <p>{{ extractors|length }} feature extraction modules</p>
            
            {% for ex in extractors[:3] %}
            <div class="extractor-item">
                <strong>{{ ex.name | default('Extractor') }}</strong>
                {% if ex.description %}
                <p class="small-text">{{ ex.description[:50] }}...</p>
                {% endif %}
            </div>
            {% endfor %}
            
            {% if extractors|length > 3 %}
            <div class="action-links">
                <span class="action-link">+{{ extractors|length - 3 }} more</span>
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Pipeline Orchestration -->
        <div class="getting-started-card">
            <div class="card-icon">🎯</div>
            <h3>Orchestration</h3>
            <p>Pipeline management and orchestration</p>
            <div class="code-block">
                <code>Automated workflow management</code>
            </div>
            <div class="action-links">
                <span class="action-link">View Details</span>
            </div>
        </div>
    </div>
</section>

{% if not (pipelines or processors or sources or extractors) %}
<div class="no-content-message">
    <div class="no-content-icon">⚙️</div>
    <h3>No AI Pipelines Detected</h3>
    <p>No AI/ML pipelines or data processing components were found.</p>
    <p>Configure pipelines to see them displayed here.</p>
</div>
{% endif %}

<!-- Pipeline Performance Dashboard -->
<section class="component-store-section" id="performance">
    <h3>🏪 Pipeline Performance Store</h3>
    <p>Monitor and optimize pipeline performance with real-time analytics.</p>
    
    <div class="performance-dashboard">
        <h4>📊 Pipeline Metrics</h4>
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value">{{ (pipeline_performance.throughput if pipeline_performance is defined else '10K') }}/h</div>
                <div class="metric-label">Throughput</div>
                <div class="metric-trend positive">↗ +15% today</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">{{ (pipeline_performance.latency if pipeline_performance is defined else '120') }}ms</div>
                <div class="metric-label">Avg Latency</div>
                <div class="metric-trend positive">↗ 20% faster</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">{{ (pipeline_performance.success_rate if pipeline_performance is defined else '99.8') }}%</div>
                <div class="metric-label">Success Rate</div>
                <div class="metric-trend positive">↗ Stable</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">{{ (pipeline_performance.cpu_usage if pipeline_performance is defined else '45') }}%</div>
                <div class="metric-label">CPU Usage</div>
                <div class="metric-trend neutral">→ Normal</div>
            </div>
        </div>
    </div>
    
    <div class="store-features">
        <div class="store-feature">
            <div class="feature-icon">🚀</div>
            <h4>Auto-Scaling</h4>
            <p>Dynamic resource allocation based on workload</p>
            <div class="feature-metrics">
                <span class="metric">⚡ Real-time</span>
                <span class="metric">📈 Adaptive</span>
                <span class="metric">💰 Cost-efficient</span>
            </div>
        </div>
        
        <div class="store-feature">
            <div class="feature-icon">🔍</div>
            <h4>Error Detection</h4>
            <p>Intelligent error detection and recovery</p>
            <div class="feature-metrics">
                <span class="metric">⚠️ Early Warning</span>
                <span class="metric">🔧 Auto-Recovery</span>
                <span class="metric">📋 Logging</span>
            </div>
        </div>
        
        <div class="store-feature">
            <div class="feature-icon">📊</div>
            <h4>Analytics</h4>
            <p>Comprehensive pipeline analytics and insights</p>
            <div class="feature-metrics">
                <span class="metric">📈 Trends</span>
                <span class="metric">🎯 Insights</span>
                <span class="metric">📊 Reports</span>
            </div>
        </div>
    </div>
</section>

<script src="assets/js/mermaid.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  if (window.mermaid) { 
    mermaid.initialize({ 
      startOnLoad: true,
      theme: 'default',
      flowchart: { useMaxWidth: true },
      graph: { useMaxWidth: true }
    }); 
  }
});
</script>
{% endblock %}